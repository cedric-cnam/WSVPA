% !TEX root = main.tex
%

\subsection*{(Alternative Algorithm for best-search)}
We shall compute the values of the functions $b_\bot$ and $b_\top$
by searching shortests paths in a $\Semiring$-labeled graph $\G_A$
associated to the \SWVPA $A$. 
This graph is defined by $\G_A = \< V_A, E_A, \eta_A >$, 
with set of vertices $V_A = (Q \times Q) \cup (Q \times P \times Q)$,
set of edges $E_A = V_A \times V_A$
(an edge $\< v_1, v_2>$, with $v_1, v_2 \in V_A$ is denoted by $v_1 \to v_2$),
and with an edge labelling  
$\eta_A : E_A \to \Semiring$ defined as follows,
for $q_0, q_1, q_2, q_3 \in Q$, $p, p' \in P$:
%
\[
\begin{array}{rclcl}
%
\< q_0, q_1> & \to & \< q_0, q_2> & : &
\bigoplus_{\Deltai} \weiei(q_1, q_2) \oplus \bigoplus_{\Deltar} \weier(q_1, q_2)\\
%
\< q_1, p, q_2> & \to & \<q_0, q_3> & : &
\bigoplus_{\Deltac} \bigl[ \weiec(q_0, p, q_1) \otimes \bigoplus^2_{\Deltar} \weir(q_2, p, q_3)\bigr]\\ 
%
%\< q_0, p, q_1> & \to & \< q_0, p, q_2> & : &
%\bigoplus_{\Deltai} \weii(q_1, p, q_2)\\
%
\< q_1, p', q_2> & \to & \< q_0, p, q_3> & : &
{\displaystyle\bigoplus_{q_0=q_1}}
{\displaystyle\bigoplus_{p=p'}}
 \bigoplus_{\Deltai} \weii(q_2, p, q_3)\\
 & & & & 
\qquad\quad 
\oplus \bigoplus^2_{\Deltac} \bigl[ \weic(q_0, p, p', q_1) \otimes_2 {\bigoplus_{\Deltar}} \weir(q_2, p', q_3) \bigr]\\
%
\end{array}
\]
Removing from $\G_A$ every edge $e \in E_A$ such that $\eta(e) = \zero$ 
is preserving the results below.
%
A \emph{path} of $\G_A$ is a sequence $\pi = v_0,\ldots, v_n \in V^*_A$,
it is called \emph{safe} when $v_0$ has the form $\< q, q>$ for some $q \in Q$.
A path $\pi$ is assigned a weight value $\weight(\pi)$ which is the product by $\otimes$ 
of the weights of the edges involved in the path.
More precisely, for all $q, q' \in Q$ and $p \in P$, we let 
$\weight(\< q, q' > ) = \one$ if $q = q'$, and $\zero$ otherwise, 
$\weight(\< q, p, q' > ) = \zero$ and 
for all $n \geq 1$, 
$\weight(v_0,\ldots, v_n) = \weight(v_0,\ldots, v_{n-1}) \otimes \eta_A(v_{n-1} \to v_{n})$.
%$\weight(\pi) = \bigotimes_{i=1}^{n} \eta(v_{i-1} \to v_i)$.

%Intuitively, 
\begin{lemma}[Correctness]
For all safe path~$\pi$ of~$\G_A$ %with $\src(\pi) = \<q_0, q_0>$,
with last element $v$, \\
($i$) if $v = \< q, q'>$, with $q, q' \in Q$, 
then there exists $u \in \Delta^*$ such that 
$\weight_A(q[\bot], u, q'[\bot]) = \weight(\pi)$,
%
($ii$) if $v = \< q, p, q'>$, with $q, q' \in Q$, $p\in P$, 
then there exists $v \in \Delta^*$ such that 
${\displaystyle\bigoplus_{c \in \Deltac}}
 \weight_A\bigl(\configup{q}{\< c, p> \stackup \top }, v, \configup{q'}{\<c, p> \stackup \top}\bigr)
 = \weight(\pi)$.
\end{lemma}
%
\begin{proof}
We prove ($i$) and ($ii$) simultaneously by induction on the length $|\pi|$ of the path $\pi$.

\noindent
The base case $|pi| = 1$ is a direct consequence of the definition of weight of paths of length 1
and the first line of \eqref{eq:SWVPA-weight}.

\noindent
If $\pi = v_0,\ldots, v_n$ with $n \geq 1$, 
let us do a case analysis on the edge $v_{n-1} \to v_n$.
...
\qed
\end{proof}



\begin{lemma}[Completeness] \label{lem:algo-completeness}
For all $q, q' \in Q$, $p\in P$, 
($i$) there exists a path~$\pi$ of~$\G_A$ 
such that $\src(\pi) = \<q_0, q_0>$ for some $q_0 \in Q$, 
$\trg(\pi) = \< q, q'>$,
and $\weight(\pi) = b_\bot(q, q')$, 
($ii$) there exists a path $\pi'$ of $\G_A$ 
such that $\src(\pi) = \<q_0, q_0>$ for some $q_0 \in Q$, 
$\trg(\pi) = \< q_1, p, q_2>$,
and $\weight(\pi) = \bigoplus_\Deltac b_\top(q_1, p, q_2)$.
\end{lemma}
%
\begin{proof}
By associativity, commutativity and distributivity for $\Semiring$,
\eqref{eq:bbot} can be rewritten into the form, unfolding~\eqref{eq:SWVPA-weight}:
%
\begin{equation}\label{eq:bbot-unfold}
b_\bot(q, q') = 
\bigoplus_{t\in \Delta^*} 
\bigoplus_{\begin{array}{c}
           \scriptstyle q_0,\ldots, q_n \in Q\\
           \scriptstyle p_{i},\ldots, p_{k} \in P
           \end{array}}
\bigotimes_{i=1}^n w_i(\tau_i)           
\end{equation}
%
where $n$ is the length of $t$, $k \leq n$,
$q_0 = q$, $q_n = q'$, 
for all $1 \leq i < n$, 
$w_i$ is one of the functions of $\bar\wei$,
$\tau_i$ is a transition of $A$ and
$\src(\tau_i) = q_{i-1}$, $\snd(\tau_i) = q_i$.
%
Since $\Semiring$ is total, there exists finite sequences as above such that
\( b_\bot(q, q') = \bigotimes_{i=i}^n w_i(\tau_i)\).
%
There might exists, for $q$ and $q'$,
several finite sequences~$\bar\tau$ and~$\bar{w}$ as above, 
let us choose arbitrarily one of minimal length~$n$. 
This integer $n$ will be denoted $n_{q, q'}$ in the following.
%We represent a computation of $A$ on $t$ by a sequence $\rho$ of its transitions, 

Similarly, following~\eqref{eq:btop} and~\eqref{eq:SWVPA-weight}, 
$\bigoplus_\Deltac b_\top(q, p, q')$ can be put in the form:
%
\begin{equation}\label{eq:btop-unfold}
{\textstyle\bigoplus_\Deltac} b_\top(q, p, q') = 
{\textstyle\bigoplus_\Deltac} \bigoplus_{t\in \Delta^*} 
\bigoplus_{\begin{array}{c}
           \scriptstyle q_0,\ldots, q_n \in Q\\
           \scriptstyle p_{i},\ldots, p_{k} \in P
           \end{array}}
\bigotimes_{i=1}^n w_i(\tau_i)           
\end{equation}
%
and hence 
\( {\textstyle\bigoplus_\Deltac} b_\top(q, p, q') = \bigotimes_{i=i}^n w_i(\tau_i) \),
using $c \in \Deltac$ that minimize the function in rhs of~\eqref{eq:btop-unfold}.
We denote the smallest $n$ as above by $n_{q, p, q'}$.

\noindent
We show now the existence of a path $\pi$ of Lemma~\ref{lem:algo-completeness}, 
by simultaneous induction on $n_{q, q'}$ and $n_{q, p, q'}$.

The base case, $n = 0$ corresponds to $t = \varepsilon$. 
In this case, by~\eqref{eq:SWVPA-weight}, $b_\top(q, p, q') = \zero$,
$b_\bot(q, q) = \one$ and $b_\bot(q, q') = \zero$ if $q \neq q'$.

\noindent
For $n = n_{q, q'} > 0$, let $\bar\tau$ and~$\bar{w}$
be the sequences associated to $q$ and $q'$ as above.
Let us do a case analysis of $w_n$.



 

\end{proof}




